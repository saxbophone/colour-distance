<!DOCTYPE html>
<html lang="en-GB">
<head>
<title>Colour Distance</title>
<style type="text/css">
#container{
  width: 640px;
}
.column {
  margin: auto 10px;
}
#colour-left {
  float: left;
  width: 200px;
}
#colour-right {
  float: right;
  width: 200px;
}
#centre {
  margin: 0 auto;
  width: 240px;
  text-align: center;
}
.colour-hex-label {
  font-family: monospace;
  font-weight: bold;
  font-size: 1.5em;
}
#colour-distance {
  font-family: monospace;
  font-weight: bold;
  font-size: 1.2em;
}
.variable {
  font-family: monospace;
  font-weight: bold;
  font-size: 1.2em;
}
</style>

<script type="text/javascript">
var colourASelector = null;
var colourBSelector = null;
var colourDistance = NaN;
var colourAVector = [0, 0, 0];
var colourBVector = [0, 0, 0];

function updateLabel(event) {
  switch (event.target.id) {
  case "colour-a":
    document.querySelector("#colour-a-hex").innerHTML = event.target.value;
    return;
  case "colour-b":
    document.querySelector("#colour-b-hex").innerHTML = event.target.value;
    return;
  default:
    console.error("updateLabel() called with unexpected target element");
  }
}

function hexToRGB(hexColour) {
  return [
    parseInt(hexColour.substring(1, 3), 16),
    parseInt(hexColour.substring(3, 5), 16),
    parseInt(hexColour.substring(5, 7), 16)
  ];
}

function RGBToLAB(rgb) {
  // XXX: bogus implementation
  return rgb;
}

function delta(tripletA, tripletB) {
  return [
    tripletA[0] - tripletB[0],
    tripletA[1] - tripletB[1],
    tripletA[2] - tripletB[2]
  ];
}

function hypotenuse3D(tripletDelta) {
  // 3D pythagoras: c² = √(x² + y² + z²)
  return Math.sqrt(
    Math.pow(tripletDelta[0], 2) +
    Math.pow(tripletDelta[1], 2) +
    Math.pow(tripletDelta[2], 2)
  );
}

function recalculate(colourA, colourB) {
  // make a copy of each so further changes to their value don't mess the maths
  var aRGB = colourA.slice();
  var bRGB = colourB.slice();
  // convert both to LAB colour space
  var aLAB = RGBToLAB(aRGB);
  var bLAB = RGBToLAB(bRGB);
  // get element-wise delta
  var deltaLAB = delta(aLAB, bLAB);
  // 3D hypotenuse of the delta is the cartesian distance between them
  colourDistance = hypotenuse3D(deltaLAB);
  document.querySelector("#colour-distance").innerHTML = colourDistance.toString();
}

function commitColour(event) {
  // also update the label
  updateLabel(event);
  switch (event.target.id) {
  case "colour-a":
    colourAVector = hexToRGB(event.target.value);
    break;
  case "colour-b":
    colourBVector = hexToRGB(event.target.value);
    break;
  default:
    console.error("commitColour() called with unexpected target element");
    return;
  }
  // if not unexpected target element, recalculate colour difference
  recalculate(colourAVector, colourBVector);
}

function startup() {
  document.querySelector("#colour-distance").innerHTML = colourDistance.toString();
  colourASelector = document.querySelector("#colour-a");
  colourBSelector = document.querySelector("#colour-b");
  colourASelector.addEventListener("input", commitColour, false);
  colourBSelector.addEventListener("input", commitColour, false);
  colourASelector.addEventListener("change", commitColour, false);
  colourBSelector.addEventListener("change", commitColour, false);
}

window.addEventListener("load", startup, false);
</script>
</head>

<body>
  <h1>Colour Distance</h1>
  <hr/>
  <p>
    A tiny web app to calculate and display the "distance" between two colours
  </p>
  <div id="container">
    <div id="colour-left" class="column">
      <label>
        Colour A
        <input type="color" id="colour-a" name="colour-a" value="#123456">
        <span id="colour-a-hex" class="colour-hex-label">#123456</span>
      </label>
      <p>XYZ = <span id="colour-a-xyz" class="variable">???</span></p>
      <p>LAB = <span id="colour-a-lab" class="variable">???</span></p>
    </div>
    <div id="colour-right" class="column">
      <label>
        <span id="colour-b-hex" class="colour-hex-label">#789abc</span>
        <input type="color" id="colour-b" name="colour-b" value="#789abc">
        Colour B
      </label>
      <p>XYZ = <span id="colour-b-xyz" class="variable">???</span></p>
      <p>LAB = <span id="colour-b-lab" class="variable">???</span></p>
    </div>
    <div id="centre">
      <p>Distance = </p>
      <p><span id="colour-distance"></span></p>
    </div>
  </div>
</body>

</html>
